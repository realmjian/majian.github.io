
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>changeip | Working hard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="majian">
    

    
    <meta name="description" content="��֮ǰ��bond0��192.168.10.x
�ȸ���IP��GPFS node IP ��192.168.10.x �ĳ�10.0.0.x��Ȼ��mmshutdown -a
����IP��GPFS������
1&amp;#10;[root@opower-gpfs1 network-scripts]# mmstartup -a&amp;#10;&amp;#10;&amp;#10;&amp;#10;CCR: failed t">
<meta property="og:type" content="article">
<meta property="og:title" content="changeip">
<meta property="og:url" content="http://www.cnfeat.com/2015/05/23/changeip/index.html">
<meta property="og:site_name" content="Working hard">
<meta property="og:description" content="��֮ǰ��bond0��192.168.10.x
�ȸ���IP��GPFS node IP ��192.168.10.x �ĳ�10.0.0.x��Ȼ��mmshutdown -a
����IP��GPFS������
1&amp;#10;[root@opower-gpfs1 network-scripts]# mmstartup -a&amp;#10;&amp;#10;&amp;#10;&amp;#10;CCR: failed t">
<meta property="og:updated_time" content="2015-05-22T16:33:18.758Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="changeip">
<meta name="twitter:description" content="��֮ǰ��bond0��192.168.10.x
�ȸ���IP��GPFS node IP ��192.168.10.x �ĳ�10.0.0.x��Ȼ��mmshutdown -a
����IP��GPFS������
1&amp;#10;[root@opower-gpfs1 network-scripts]# mmstartup -a&amp;#10;&amp;#10;&amp;#10;&amp;#10;CCR: failed t">

    
    <link rel="alternative" href="/atom.xml" title="Working hard" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Working hard" title="Working hard"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Working hard">Working hard</a></h1>
				<h2 class="blog-motto">Writing 1000 Words a Day Changes My Life</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:www.cnfeat.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/05/23/changeip/" title="changeip" itemprop="url">changeip</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="majian" target="_blank" itemprop="author">majian</a>
		
  <p class="article-time">
    <time datetime="2015-05-22T16:32:41.000Z" itemprop="datePublished"> 发表于 2015-05-23</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			
		
		</div>
		
		<p>��֮ǰ��bond0��192.168.10.x</p>
<p>�ȸ���IP��GPFS node IP ��192.168.10.x �ĳ�10.0.0.x��Ȼ��mmshutdown -a</p>
<p>����IP��GPFS������</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmstartup -a&#10;&#10;&#10;&#10;CCR: failed to connect to node 192.168.10.10:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.12:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.11:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.10:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.12:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.11:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.10:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.12:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.11:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.10:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.12:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.11:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.10:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.12:1191 (sock 4 err 1143)&#10;&#10;CCR: failed to connect to node 192.168.10.11:1191 (sock 4 err 1143)&#10;&#10;get file failed: err 801&#10;&#10;gpfsClusterInit: Unexpected error from ccr fget mmsdrfs.  Return code: 149&#10;&#10;mmstartup: Command failed. Examine previous error messages to determine cause.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 gpfsconfig]# mmchnode --daemon-interface=gpfs1 --admin-interface=gpfs1 -N gpfs1&#10;&#10;mmchnode: Unable to obtain the GPFS configuration file lock.&#10;&#10;mmchnode: GPFS was unable to obtain a lock from node gpfs1.&#10;&#10;mmchnode: Command failed. Examine previous error messages to determine cause.</span><br></pre></td></tr></table></figure>
<p>��BOND0������em2��em3�ֱ���192.168��10.0.�ĵ�ַ����hosts����֤��IP/HOSTNAME����IP/hostname��pingͨ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# cat /etc/hosts&#10;&#10;127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4&#10;&#10;::1         localhost localhost.localdomain localhost6 localhost6.localdomain6&#10;&#10;172.16.10.10    opower-gpfs1&#10;&#10;172.16.10.11    opower-gpfs2&#10;&#10;172.16.10.12    opower-gpfs3&#10;&#10;192.168.10.10   gpfs1&#10;&#10;192.168.10.11   gpfs2&#10;&#10;192.168.10.12   gpfs3&#10;&#10;10.0.0.210      gpfs-quorum1&#10;&#10;10.0.0.211      gpfs-quorum2&#10;&#10;10.0.0.212      gpfs-quorum3</span><br></pre></td></tr></table></figure>
<p>��mmchnode����������</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmchnode --daemon-interface=gpfs-quorum1 --admin-interface=gpfs-quorum1 -N gpfs1&#10;&#10;Thu Jan 15 10:51:29 CST 2015: mmchnode: Processing node gpfs1&#10;&#10;mmchnode: GPFS daemon interfaces cannot be changed when CCR is in effect.&#10;&#10;    To change the interface, consider using:&#10;&#10;        mmchcluster --ccr-disable&#10;&#10;        mmchnode --daemon-interface=gpfs-quorum1 --admin-interface=gpfs-quorum1 -N gpfs1&#10;&#10;        mmchcluster --ccr-enable</span><br></pre></td></tr></table></figure>
<p>������ʾ��</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmchcluster --ccr-disable&#10;&#10;Verifying GPFS is stopped on all nodes ...&#10;&#10;mmchcluster: GPFS cluster configuration servers:&#10;&#10;mmchcluster:   Primary server:    gpfs1&#10;&#10;mmchcluster:   Secondary server:  (none)&#10;&#10;mmchcluster: Propagating the new server information to the rest of the nodes.&#10;&#10;mmchcluster: Command successfully completed&#10;&#10;[root@opower-gpfs1 network-scripts]#</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmchnode --daemon-interface=gpfs-quorum1 --admin-interface=gpfs-quorum1 -N gpfs1&#10;&#10;Thu Jan 15 10:55:06 CST 2015: mmchnode: Processing node gpfs1&#10;&#10;The authenticity of host &#39;gpfs-quorum1 (10.0.0.210)&#39; can&#39;t be established.&#10;&#10;RSA key fingerprint is 95:3d:7f:d0:c2:19:c5:49:0b:23:a6:ed:0b:e4:53:d9.&#10;&#10;Are you sure you want to continue connecting (yes/no)? yes&#10;&#10;Verifying GPFS is stopped on all nodes ...&#10;&#10;&#10;&#10;mmchnode: Propagating the cluster configuration data to all&#10;&#10;  affected nodes.  This is an asynchronous process.</span><br></pre></td></tr></table></figure>
<p>change other nodes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmchnode --daemon-interface=gpfs-quorum2 --admin-interface=gpfs-quorum2 -N gpfs2  &#10;&#10;Thu Jan 15 10:56:10 CST 2015: mmchnode: Processing node gpfs2&#10;&#10;The authenticity of host &#39;gpfs-quorum2 (10.0.0.211)&#39; can&#39;t be established.&#10;&#10;RSA key fingerprint is c7:ca:13:d1:10:c9:e1:fc:da:b3:c1:6e:1b:44:37:0b.&#10;&#10;Are you sure you want to continue connecting (yes/no)? yes&#10;&#10;Verifying GPFS is stopped on all nodes ...&#10;&#10;&#10;&#10;mmchnode: Propagating the cluster configuration data to all&#10;&#10;  affected nodes.  This is an asynchronous process.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmchnode --daemon-interface=gpfs-quorum3 --admin-interface=gpfs-quorum3 -N gpfs3  &#10;&#10;Thu Jan 15 10:56:40 CST 2015: mmchnode: Processing node gpfs3&#10;&#10;The authenticity of host &#39;gpfs-quorum3 (10.0.0.212)&#39; can&#39;t be established.&#10;&#10;RSA key fingerprint is 93:9f:7e:a5:56:ed:4c:65:aa:30:0d:ff:9d:77:4f:3e.&#10;&#10;Are you sure you want to continue connecting (yes/no)? yes&#10;&#10;Verifying GPFS is stopped on all nodes ...&#10;&#10;&#10;&#10;mmchnode: Propagating the cluster configuration data to all&#10;&#10;  affected nodes.  This is an asynchronous process.</span><br></pre></td></tr></table></figure>
<p>��֤һ��</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmlscluster&#10;&#10;&#10;&#10;GPFS cluster information&#10;&#10;========================&#10;&#10;  GPFS cluster name:         OPowerGPFS.gpfs1&#10;&#10;  GPFS cluster id:           14862933950719025506&#10;&#10;  GPFS UID domain:           OPowerGPFS.gpfs1&#10;&#10;  Remote shell command:      /usr/bin/ssh&#10;&#10;  Remote file copy command:  /usr/bin/scp&#10;&#10;  Repository type:           server-based&#10;&#10;&#10;&#10;GPFS cluster configuration servers:&#10;&#10;-----------------------------------&#10;&#10;  Primary server:    gpfs-quorum1&#10;&#10;  Secondary server:  (none)&#10;&#10;&#10;&#10; Node  Daemon node name  IP address  Admin node name  Designation&#10;&#10;------------------------------------------------------------------&#10;&#10;   1   gpfs-quorum1      10.0.0.210  gpfs-quorum1     quorum-manager&#10;&#10;   2   gpfs-quorum2      10.0.0.211  gpfs-quorum2     quorum-manager&#10;&#10;   3   gpfs-quorum3      10.0.0.212  gpfs-quorum3     quorum-manager</span><br></pre></td></tr></table></figure>
<p>����enable ccr</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmchcluster --ccr-enable&#10;&#10;mmchcluster: Command successfully completed&#10;&#10;mmchcluster: Propagating the cluster configuration data to all&#10;&#10;  affected nodes.  This is an asynchronous process.</span><br></pre></td></tr></table></figure>
<p>���¸�Ϊbond0</p>
<p>������GPFS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmstartup -a&#10;&#10;Thu Jan 15 11:04:08 CST 2015: mmstartup: Starting GPFS ...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# mmgetstate -aLs&#10;&#10;&#10;&#10; Node number  Node name       Quorum  Nodes up  Total nodes  GPFS state  Remarks    &#10;&#10;------------------------------------------------------------------------------------&#10;&#10;       1      gpfs-quorum1       2        3          3       active      quorum node&#10;&#10;       2      gpfs-quorum2       2        3          3       active      quorum node&#10;&#10;       3      gpfs-quorum3       2        3          3       active      quorum node&#10;&#10;&#10;&#10; Summary information &#10;&#10;---------------------&#10;&#10;Number of nodes defined in the cluster:            3&#10;&#10;Number of local nodes active in the cluster:       3&#10;&#10;Number of remote nodes joined in this cluster:     0&#10;&#10;Number of quorum nodes defined in the cluster:     3&#10;&#10;Number of quorum nodes active in the cluster:      3&#10;&#10;Quorum = 2, Quorum achieved</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;[root@opower-gpfs1 network-scripts]# df -h&#10;&#10;Filesystem                          Size  Used Avail Use% Mounted on&#10;&#10;/dev/mapper/vg_opowergpfs1-lv_root   50G  4.0G   43G   9% /&#10;&#10;tmpfs                                64G   72K   64G   1% /dev/shm&#10;&#10;/dev/sda1                           485M   39M  421M   9% /boot&#10;&#10;/dev/mapper/vg_opowergpfs1-lv_home  863G  200M  819G   1% /home&#10;&#10;/dev/gpfs                            37T  2.7G   37T   1% /gpfs</span><br></pre></td></tr></table></figure>
<p>DONE</p>
<p><a href="http://www-01.ibm.com/support/knowledgecenter/SSFKCN_3.5.0/com.ibm.cluster.gpfs.v3r5.gpfs200.doc/bl1adv_chnamip.htm" target="_blank" rel="external">http://www-01.ibm.com/support/knowledgecenter/SSFKCN_3.5.0/com.ibm.cluster.gpfs.v3r5.gpfs200.doc/bl1adv_chnamip.htm</a></p>
<p>Changing IP addresses and host names</p>
<p>GPFS? assumes that IP addresses and host names remain constant. In the rare event that such a change becomes necessary or is inadvertently introduced by reinstalling a node with a disk image from a different node for example, follow the steps in this topic.</p>
<p>If all of the nodes in the cluster are affected and all the conditions in step 2 below are met:<br>Use the mmshutdown -a command to stop GPFS on all nodes.<br>Using the documented procedures for the operating system, add the new host names or IP addressees, but do not remove the old ones yet. This can be achieved, for example, by creating temporary alias entries in /etc/hosts. Avoid rebooting the nodes until the mmchnode command in step 3 is executed successfully. If any of these conditions cannot be met, utilize the alternate procedure described below.<br>Use mmchnode —daemon-interface and —admin-interface to update the GPFS configuration information.<br>If the IP addresses over which the subnet attribute is defined are changed, you need to update your configuration by using the mmchconfig command with the subnets attribute.<br>Start GPFS on all nodes with mmstartup -a.<br>Remove the unneeded old host names and IP addresses.<br>If only a subset of the nodes are affected, it may be easier to make the changes using these steps:<br>Before any of the host names or IP addresses are changed:<br>Use the mmshutdown command to stop GPFS on all affected nodes.<br>If the host names or IP addresses of the primary or secondary GPFS cluster configuration server nodes must change, use themmchcluster command to specify another node to serve as the primary or secondary GPFS cluster configuration server.<br>If the host names or IP addresses of an NSD server node must change, temporarily remove the node from being a server with themmchnsd command. Then, after the node has been added back to the cluster, use the mmchnsd command to change the NSDs to their original configuration. Use the mmlsnsd command to obtain the NSD server node names.<br>Use the mmdelnode command to delete all affected nodes from the GPFS cluster.<br>Change the node names and IP addresses using the documented procedures for the operating system.<br>If the IP addresses over which the subnet attribute is defined are changed, you need to update your configuration by using the mmchconfig command with the subnets attribute.<br>Issue the mmaddnode command to restore the nodes to the GPFS cluster.<br>If necessary, use the mmchcluster and mmchnsd commands to restore the original configuration and the NSD servers.<br><a href="http://terry2magic.blog.163.com/blog/static/692590572013728115625955/" target="_blank" rel="external">http://terry2magic.blog.163.com/blog/static/692590572013728115625955/</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.cnfeat.com/2015/05/23/changeip/" data-title="changeip | Working hard" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/05/23/hello-world/" title="Hello World">
  <strong>上一篇：</strong><br/>
  <span>
  Hello World</span>
</a>
</div>


<div class="next">
<a href="/2015/05/22/my-new-post/"  title="my new post">
 <strong>下一篇：</strong><br/> 
 <span>my new post
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="majian">majian</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
